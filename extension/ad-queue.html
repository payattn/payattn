<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PayAttn: Ad Management</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      min-height: 100vh;
      color: #e2e8f0;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
    }
    
    .header {
      margin-bottom: 24px;
    }
    
    .header h1 {
      margin: 0 0 8px 0;
      font-size: 32px;
      color: #f1f5f9;
    }
    
    .header p {
      margin: 0;
      color: #94a3b8;
      font-size: 14px;
    }
    
    .pagination-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .pagination-btn {
      padding: 8px 16px;
      background: #334155;
      border: 1px solid #475569;
      border-radius: 6px;
      color: #e2e8f0;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .pagination-btn:hover {
      background: #475569;
      border-color: #64748b;
    }
    
    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .fetch-ads-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      margin-bottom: 24px;
    }
    
    .fetch-ads-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
    }
    
    .fetch-ads-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .fetch-ads-btn:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .session-info {
      text-align: center;
    }
    
    .session-date {
      font-size: 14px;
      font-weight: 600;
      color: #f1f5f9;
    }
    
    .session-id {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 4px;
    }
    
    .filter-container {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      padding: 12px;
      background: #0f172a;
      border-radius: 8px;
    }
    
    .filter-btn {
      padding: 8px 16px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 6px;
      color: #cbd5e1;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .filter-btn:hover {
      background: #334155;
      border-color: #475569;
    }
    
    .filter-btn.filter-active {
      background: #6366f1;
      border-color: #a78bfa;
      color: white;
    }
    
    .status-banner {
      padding: 16px;
      background: #1e40af;
      border: 1px solid #3b82f6;
      border-radius: 8px;
      margin-bottom: 24px;
      display: none; /* Hidden by default */
    }
    
    .status-banner.visible {
      display: block;
    }
    
    .status-banner.processing {
      background: #7c3aed;
      border-color: #a78bfa;
    }
    
    .status-banner.complete {
      background: #047857;
      border-color: #10b981;
    }
    
    .status-text {
      font-size: 16px;
      font-weight: 500;
      color: white;
      margin: 0;
    }
    
    .status-subtext {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      margin-top: 4px;
    }
    
    .ads-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .ad-assessment {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 20px;
      transition: all 0.3s ease;
    }
    
    .ad-assessment.pending {
      border-color: #64748b;
      background: #1e293b;
      opacity: 0.5;
    }
    
    .ad-assessment.processing {
      border-color: #f59e0b;
      background: linear-gradient(135deg, #1e293b 0%, #78350f 100%);
      opacity: 1;
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
    
    .ad-assessment.rejected {
      border-color: #dc2626;
      background: linear-gradient(135deg, #1e293b 0%, #450a0a 100%);
    }
    
    .ad-assessment.offered {
      border-color: #10b981;
      background: linear-gradient(135deg, #1e293b 0%, #064e3b 100%);
    }
    
    .ad-assessment.queued {
      border-color: #64748b;
      background: #1e293b;
    }
    
    .ad-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .advertiser-logo {
      width: 40px;
      height: 40px;
      background: #334155;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .ad-info {
      flex: 1;
    }
    
    .ad-name {
      font-size: 15px;
      font-weight: 600;
      color: #f1f5f9;
      margin: 0;
    }
    
    .advertiser-name {
      font-size: 12px;
      color: #94a3b8;
      margin: 2px 0 0 0;
    }
    
    .ad-body {
      padding: 12px;
      background: #0f172a;
      border-radius: 6px;
      margin: 12px 0;
    }
    
    .thinking-text {
      font-size: 12px;
      color: #cbd5e1;
      line-height: 1.6;
      margin: 0;
      font-style: italic;
    }
    
    .targeting-info {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: #cbd5e1;
      margin: 12px 0;
      flex-wrap: wrap;
    }
    
    .targeting-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .decision {
      padding: 12px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 13px;
      margin: 12px 0 0 0;
    }
    
    .decision.reject {
      background: #450a0a;
      color: #fca5a5;
      border: 1px solid #dc2626;
    }
    
    .decision.offered {
      background: #064e3b;
      color: #86efac;
      border: 1px solid #10b981;
    }
    
    .decision.queued {
      background: #334155;
      color: #cbd5e1;
      border: 1px solid #64748b;
    }
    
    .zk-proof {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
      font-size: 12px;
      color: #cbd5e1;
    }
    
    .zk-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #6366f1;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
    }
    
    .loading {
      text-align: center;
      padding: 40px 20px;
    }
    
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 3px solid #334155;
      border-top-color: #a78bfa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 16px;
      font-size: 14px;
      color: #94a3b8;
    }
    
    .error {
      background: #7f1d1d;
      border: 1px solid #dc2626;
      color: #fca5a5;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
    }
    
    .complete-summary {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 20px;
      margin-top: 24px;
    }
    
    .summary-title {
      font-size: 16px;
      font-weight: 600;
      color: #94a3b8;
      margin: 0 0 12px 0;
    }
    
    .summary-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
    }
    
    .summary-stat {
      background: rgba(0, 0, 0, 0.2);
      padding: 12px;
      border-radius: 6px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 24px;
      font-weight: bold;
      color: #cbd5e1;
    }
    
    .stat-label {
      font-size: 11px;
      color: #94a3b8;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="payattn_logo_bar01_700x140_trans.png" alt="PayAttn" style="width: 100%; max-width: 350px; height: auto; margin: 0 auto 16px; display: block;">
      <h2 style="font-size: 24px; margin: 0 0 8px 0; color: #f1f5f9; text-align: center;">Max's Activity</h2>
      <p style="text-align: center;">Max is continuously evaluating ad opportunities on your behalf so you don't need to do anything. You can scroll through the decisions he's made below. If you want see him work in realtime, press "Fetch & Assess New Ads" below.</p>
    </div>
    
    <!-- Fetch New Ads Button -->
    <button id="fetchAdsBtn" class="fetch-ads-btn">
      Fetch & Assess New Ads
    </button>
    
    <!-- Session Pagination -->
    <div class="pagination-container">
      <button id="prevSession" class="pagination-btn"> Older</button>
      <div class="session-info">
        <div class="session-date" id="sessionDate">Loading...</div>
      </div>
      <button id="nextSession" class="pagination-btn">Newer </button>
    </div>
    
    <!-- Filter Controls -->
    <div class="filter-container">
      <button class="filter-btn filter-active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="offered"> Offered</button>
      <button class="filter-btn" data-filter="rejected"> Rejected</button>
    </div>
    
    <div id="statusBanner" class="status-banner">
      <p class="status-text"> Max is assessing opportunities...</p>
      <p class="status-subtext">Fetching ad campaigns</p>
    </div>
    
    <div id="content">
      <div class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Max is evaluating opportunities...</div>
      </div>
    </div>
    
    <!-- Bottom Pagination -->
    <div class="pagination-container" style="margin-top: 32px;">
      <button id="prevSessionBottom" class="pagination-btn"> Older</button>
      <div class="session-info">
        <div class="session-date" id="sessionDateBottom">Loading...</div>
      </div>
      <button id="nextSessionBottom" class="pagination-btn">Newer </button>
    </div>
    
    <!-- Subtle Session ID below bottom nav -->
    <div id="subtleSessionId" style="text-align: center; font-size: 10px; color: #64686e; margin-top: 8px; margin-bottom: 16px;">Session ID: --</div>
  </div>
  
  <!-- ZK-SNARK proof generation (patched for browser/service worker compatibility) -->
  <script src="lib/snarkjs-patched.js"></script>
  <script src="lib/zk-prover.js"></script>
  <script src="llm-service.js"></script>
  <script src="crypto.js"></script>
  <!-- Max Assessment Module (shared with background.js) -->
  <script src="lib/max-assessor.js"></script>
  <script src="ad-queue.js"></script>
</body>
</html>
